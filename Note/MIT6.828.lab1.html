<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-06-25 Thu 07:03 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MIT6.828 Lab 1</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Comcx" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="org-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="org-themes/styles/readtheorg/css/readtheorg.css"/>
<script type="text/javascript" src="org-themes/styles/lib/js/jquery.min.js"></script>
<script type="text/javascript" src="org-themes/styles/lib/js/bootstrap.min.js"></script>
<script type="text/javascript" src="org-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="org-themes/styles/readtheorg/js/readtheorg.js"></script>
<style>pre.src{background:#343131;color:white;} </style>
<style> #content{max-width:1800px;}</style>
<style> p{max-width:800px;}</style>
<link rel="icon" type="image/x-icon" href="../images/digimon-icon.png" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">MIT6.828 Lab 1</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org924a252">1. Software and Environment Setup</a>
<ul>
<li><a href="#orgffb26c7">1.1. Pull ubuntu from docker-hub and make a dockerfile</a></li>
<li><a href="#org1bbd0fd">1.2. Install patched QEMU</a>
<ul>
<li><a href="#orgcfb79f3">1.2.1. Pitfalls</a></li>
</ul>
</li>
<li><a href="#org3cb887b">1.3. Pull JOS repository</a></li>
</ul>
</li>
<li><a href="#org58c7b3c">2. Part 1: PC Bootstrap</a>
<ul>
<li><a href="#org13100a4">2.1. Exercise 1</a></li>
<li><a href="#org9c825e7">2.2. The PC's Physical Address Space</a></li>
<li><a href="#org84dc85b">2.3. Exercise 2</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
I want to review MIT6.828 labs and homework&#x2026;
This is still essential for me to make a better pl someday :)
</p>

<ul class="org-ul">
<li>Reference</li>
</ul>
<p>
<a href="https://pdos.csail.mit.edu/6.828/2018/labs/lab1/">MIT6.828 2018 Lab 1</a>
</p>

<div id="outline-container-org924a252" class="outline-2">
<h2 id="org924a252"><span class="section-number-2">1</span> Software and Environment Setup</h2>
<div class="outline-text-2" id="text-1">
<p>
The origin course uses <span class="underline">athena</span> and a patched <span class="underline">qemu</span> .
I do not want to install a new virtual OS or have a new computer or
ruin my current computer.
Therefore, I decide to use <span class="underline">docker</span> and make a virtual environment which is
effcient and light-weight.
</p>

<p>
The process is a little tough though&#x2026;
</p>
</div>

<div id="outline-container-orgffb26c7" class="outline-3">
<h3 id="orgffb26c7"><span class="section-number-3">1.1</span> Pull ubuntu from docker-hub and make a dockerfile</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-shell">$ docker pull ubuntu:18.04
</pre>
</div>

<ul class="org-ul">
<li>Dockerfile</li>
</ul>
<pre class="example">
FROM ubuntu:18.04

RUN apt-get update \
    &amp;&amp; apt-get install -y \
    sudo \
    git \
    g++ \
    emacs \
    make \
    gcc-multilib \
    &amp;&amp; useradd --create-home --no-log-init --shell /bin/bash comcx \
    &amp;&amp; adduser comcx sudo \
    &amp;&amp; echo 'comcx:mimawei0' | chpasswd

USER comcx
WORKDIR /home/comcx

</pre>

<ul class="org-ul">
<li>Build</li>
</ul>
<pre class="example">
$ docker build -t oslab .
</pre>
<p>
Now we have a very small environment prototype which will be fixed into our experiment space later:)
</p>

<p>
Run the following command into the container!
</p>
<pre class="example">
$ docker run -it oslab bash
</pre>
</div>
</div>

<div id="outline-container-org1bbd0fd" class="outline-3">
<h3 id="org1bbd0fd"><span class="section-number-3">1.2</span> Install patched QEMU</h3>
<div class="outline-text-3" id="text-1-2">
<p>
We need to firstly pull the patched qemu following reference page.
<a href="https://pdos.csail.mit.edu/6.828/2018/tools.html">Tool page</a>
</p>
<div class="org-src-container">
<pre class="src src-shell">$ git clone https://github.com/mit-pdos/6.828-qemu.git qemu
$ cd qemu
$ ./configure --disable-kvm --disable-werror --disable-sdl <span style="color: #ffd700;">[</span>--prefix=PFX<span style="color: #ffd700;">]</span> <span style="color: #ffd700;">[</span>--target-list=<span style="color: #ad7fa8; font-style: italic;">"i386-softmmu x86_64-softmmu"</span><span style="color: #ffd700;">]</span>
$ make &amp;&amp; make install
</pre>
</div>
</div>

<div id="outline-container-orgcfb79f3" class="outline-4">
<h4 id="orgcfb79f3"><span class="section-number-4">1.2.1</span> Pitfalls</h4>
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li>Executing "./configure &#x2013;disable-kvm &#x2026;" 
<ul class="org-ul">
<li>ERROR: Python not found. Use &#x2013;python=/path/to/python</li>
<li>To fix: install python2.7, and add &#x2013;python=python2.7</li>

<li>ERROR: pkg-config binary 'pkg-config' not found</li>
<li>apt-get install -y pkg-config</li>

<li>ERROR: zlib check failed. Make sure to have the zlib libs and headers installed.</li>
<li>sudo apt-get install zlib1g-dev</li>

<li>ERROR: glib-2.12 gthread-2.0 is required to compile QEMU</li>
<li>sudo apt-get install libglib2.0-dev</li>
</ul></li>
</ul>

<p>
Finally, we are done.
</p>
</div>
</div>
</div>

<div id="outline-container-org3cb887b" class="outline-3">
<h3 id="org3cb887b"><span class="section-number-3">1.3</span> Pull JOS repository</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-shell">$ git clone https://pdos.csail.mit.edu/6.828/2018/jos.git lab
</pre>
</div>

<p>
Inside lab/, try <code>make qemu</code> ,if the program runs, then our basic experiment space is now ready.
</p>
<pre class="example">
$ docker commit &lt;container&gt; mit6.828
</pre>
</div>
</div>
</div>

<div id="outline-container-org58c7b3c" class="outline-2">
<h2 id="org58c7b3c"><span class="section-number-2">2</span> Part 1: PC Bootstrap</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org13100a4" class="outline-3">
<h3 id="org13100a4"><span class="section-number-3">2.1</span> Exercise 1</h3>
<div class="outline-text-3" id="text-2-1">
<blockquote>
<p>
Familiarize yourself with the assembly language materials available on the 6.828 reference page. 
You don't have to read them now, but you'll almost certainly want to refer to some of this material when reading and writing x86 assembly.
</p>

<p>
We do recommend reading the section "The Syntax" in Brennan's Guide to Inline Assembly. 
It gives a good (and quite brief) description of the AT&amp;T assembly syntax we'll be using with the GNU assembler in JOS.
</p>
</blockquote>

<p>
<a href="http://www.delorie.com/djgpp/doc/brennan/brennan_att_inline_djgpp.html">Brennan's Guide to Inline Assembly</a> is nice for both intel and AT&amp;T syntax(I prefer intel).
The <span class="underline">PCASM book</span> helps me a lot!
</p>

<p>
Finally, I am comfortable with most of assembly programs, but still lack experience and have some problems at use of
<code>in</code> and <code>out</code> commands&#x2026;
</p>
</div>
</div>

<div id="outline-container-org9c825e7" class="outline-3">
<h3 id="org9c825e7"><span class="section-number-3">2.2</span> The PC's Physical Address Space</h3>
<div class="outline-text-3" id="text-2-2">
<pre class="example">
+------------------+  &lt;- 0xFFFFFFFF (4GB)
|      32-bit      |
|  memory mapped   |
|     devices      |
|                  |
/\/\/\/\/\/\/\/\/\/\

/\/\/\/\/\/\/\/\/\/\
|                  |
|      Unused      |
|                  |
+------------------+  &lt;- depends on amount of RAM
|                  |
|                  |
| Extended Memory  |
|                  |
|                  |
+------------------+  &lt;- 0x00100000 (1MB)
|     BIOS ROM     |
+------------------+  &lt;- 0x000F0000 (960KB)
|  16-bit devices, |
|  expansion ROMs  |
+------------------+  &lt;- 0x000C0000 (768KB)
|   VGA Display    |
+------------------+  &lt;- 0x000A0000 (640KB)
|                  |
|    Low Memory    |
|                  |
+------------------+  &lt;- 0x00000000
</pre>
<p>
This general picture of memory is important.
</p>

<p>
The layout exposes design compromise due to back compatibility.
To allow old PCs of 16bits, we still maintain the layout of 0x0 ~ 0x100000(old 8086 has 1MB space)
</p>

<p>
The BIOS ROM is first loaded into memory and then be executed when a computer powers on.
Let's inspect how BIOS is loaded and executed and eventually die out&#x2026;
</p>

<p>
Simulate our qemu!
The following line:
</p>
<pre class="example">
[f000:fff0] 0xffff0:	ljmp   $0xf000,$0xe05b
</pre>
<p>
is GDB's disassembly of the first instruction to be executed. From this output you can conclude a few things:
</p>

<ul class="org-ul">
<li>The IBM PC starts executing at physical address 0x000ffff0, which is at the very top of the 64KB area reserved for the ROM BIOS.</li>
<li>The PC starts executing with CS = 0xf000 and IP = 0xfff0.</li>
<li>The first instruction to be executed is a jmp instruction, which jumps to the segmented address CS = 0xf000 and IP = 0xe05b.</li>
</ul>

<p>
Well this looks weird, why have to first execute at 0xffff0 and immediately jump to 0xfe05b?
</p>
</div>
</div>


<div id="outline-container-org84dc85b" class="outline-3">
<h3 id="org84dc85b"><span class="section-number-3">2.3</span> Exercise 2</h3>
<div class="outline-text-3" id="text-2-3">
<blockquote>
<p>
Use GDB's si (Step Instruction) command to trace into the ROM BIOS for a few more instructions, 
and try to guess what it might be doing. 
</p>

<p>
You might want to look at Phil Storrs I/O Ports Description, 
as well as other materials on the 6.828 reference materials page. 
No need to figure out all the details - just the general idea of what the BIOS is doing first.
</p>
</blockquote>
<p>
OK, just the general idea:)
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Comcx</p>
<p class="date">Created: 2020-06-25 Thu 07:03</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
