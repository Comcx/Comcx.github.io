#+Title:  Agda language study
#+Author: Comcx

#+SETUPFILE: theme-readtheorg-local.setup


å› ä¸º /agda/ çš„å›½å†…ä½¿ç”¨è€…è¿˜å¾ˆå°‘ï¼Œä¸ºäº†æ»¡è¶³æˆ‘çš„å®‰åˆ©æ¬²ï¼Œæˆ‘æ‰“ç®—ç”¨ä¸­æ–‡å†™æˆ‘çš„agdaå­¦ä¹ ç¬”è®°ä¸è¿‡ç¨‹ï¼Œå¸Œæœ›å¯ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è·å¾—æ–°çŸ¥çš„å¿«ä¹ã€‚
Agdaæ˜¯ä¸€æ¬¾ä¾èµ–ç±»å‹ç³»ç»Ÿä¸ºæ ¸å¿ƒçš„è¯­è¨€ï¼Œæ‰€ä»¥æ”¯æŒå½¢å¼åŒ–è¯æ˜ï¼ˆå®é™…ä¸Šè¿™ä¹Ÿæ˜¯agdaçš„é‡è¦ç”¨é€”ï¼‰ã€‚æ­¤å¤–ï¼Œagdaçš„è®¾è®¡ä¹Ÿååˆ†æœ‰è¶£ï¼Œæ— è®ºæ˜¯
æ··åˆå‰ä¸­åç¼€è¯­æ³•è¿˜æ˜¯ç±»Haskellçš„ä»£ç é£æ ¼ï¼Œéƒ½ç»™äºˆäº†ç©å®¶æå¤§çš„è‡ªç”±ã€‚åœ¨agdaçš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ²¡æœ‰ =Integer= ï¼Œæ²¡æœ‰ =Bool= ,
ä½†æ˜¯æˆ‘ä»¬å´è·å¾—äº†åˆ›é€ ä¸€åˆ‡çš„æœ¨å¤´ï¼ˆæ²¡é”™ï¼Œç±»ä¼¼Minecraftï¼‰ã€‚åœ¨æ²¡æœ‰agda-stdlibçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªåŠ›æ›´ç”Ÿï¼Œæˆä¸ºæ¬¢ä¹åŸå§‹äººæˆ–è€…ï¼Œ
æˆä¸º *åˆ›é€ ç¥ã€‚*

æˆ‘æƒ³åœ¨è¿™é‡Œé¦–å…ˆåæ§½ä¸€ç•ªæˆ‘è¸©è¿‡çš„å®‰è£…agdaçš„å‘ï¼
1. Ubuntuä¸‹çš„agda-binå’Œagda-stdlibä¹Ÿè®¸ä¸å…¼å®¹ã€‚
  æˆ‘å°è¯•äº†Næ¬¡åœ¨Ubuntuä¸‹å®‰è£…agdaï¼Œä¸€æ¬¡ä¹Ÿæ²¡æˆåŠŸè¿‡ï¼æˆ‘æŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œæœ€ç»ˆè®¤ä¸ºä¹Ÿè®¸æ˜¯å†…éƒ¨æœ‰ä¸å…¼å®¹ã€‚

2. Archå¹³å°æˆ‘ä¹Ÿå®‰è£…äº†Næ¬¡ï¼Archä¸€ç›´æç¤ºç¼ºå°‘IEEEçš„åº“ï¼Œæˆ‘é‡è£…äº†é‚£ä¸ªåº“è¿˜æ˜¯æ²¡æœ‰åµç”¨ã€‚ã€‚ã€‚

3. Cabalå›½å†…è®¿é—®é€Ÿåº¦é¾Ÿé€Ÿï¼Œå‡ ä¹æ— æ³•ä½¿ç”¨ï¼Œæ¢äº†é•œåƒç»§ç»­çˆ†ç‚¸ã€‚ã€‚ã€‚
  æ¸…åæºå®‰è£…ç»§ç»­å¤±è´¥ï¼ŒåŸå› ä¸æ˜ï¼š(


åœ¨ç»æœ›ä¸­ï¼Œæˆ‘ä¸‹è½½äº† _Agda bundle_ çš„windowsç‰ˆæœ¬ï¼Œç»“æœå±…ç„¶æˆåŠŸäº†ï¼Œç¬¬äºŒæ¬¡è¿™ä¹ˆæƒ³èµç¾winï¼ˆç¬¬ä¸€æ¬¡æ˜¯TypeScriptï¼‰ã€‚
äºæ˜¯ç°åœ¨æˆ‘ç»ˆäºå¯ä»¥å¼€å§‹æ„‰å¿«çš„å­¦ä¹ ç¼–ç¨‹äº†ï¼


** å¯¹Agdaçš„ç¬¬ä¸€å°è±¡

é¦–å…ˆï¼Œagdaç»ˆäºç»Ÿä¸€äº†term, typeçš„åŒºåˆ«ï¼Œå¤§å®¶éƒ½æ„‰å¿«çš„å˜æˆäº†ä¸€ç§ä¸œè¥¿ã€‚å› æ­¤æˆ‘ä»¬ä¹Ÿå°±å‡ ä¹ä¸éœ€è¦ç±»ä¼¼ =type= å…³é”®è¯ä¹‹ç±»çš„å¤šä½™çš„è®¾æ–½ã€‚
å¯¹äºHaskellç©å®¶æ¥è¯´ï¼Œagdaä¸€ä¸Šæ¥æœ€æ˜æ˜¾çš„åŒºåˆ«æ˜¯ç±»å‹æ ‡è®°çš„ç¬¦å·ä» =::= å˜æˆäº† =ï¼š= ã€‚
#+BEGIN_SRC agda
foo : Set

#+END_SRC
æ­¤å¤„ =Set= ç©ç›®ã€‚å¦‚æœä½ ä½¿ç”¨è¿‡haskellçš„è¯ï¼Œé‚£ä¹ˆä½ ä¸€å®šçŸ¥é“haskellçš„ =kind= ã€‚kindåœ¨haskellé‡Œå†™ä½œ =*= ã€‚åœ¨haskellé‡Œå¦‚æœæˆ‘ä»¬éœ€è¦
ç‰¹åˆ«å¯¹ç±»å‹è¿›è¡Œé™å®šï¼Œæˆ‘ä»¬è¦å†™ï¼š
#+BEGIN_SRC haskell
class Functor f :: * -> * where
  ...
#+END_SRC
ä¹‹ç±»çš„ä»£ç ï¼Œå…¶å®agdaè¿™é‡Œä¸ä»…æŠŠ =*= æ¢æˆäº† =Set= ï¼Œè€Œä¸”agdaè¿˜æœ‰ä¸åŒå±‚æ¬¡çš„ _universe_ (ç”¨æ¥é€ƒé¿ç½—ç´ æ‚–è®º)ã€‚

æ­¤å¤–ï¼Œagdaçš„ADTå£°æ˜æ–¹å¼ç»Ÿä¸€é‡‡ç”¨haskellçš„ *GADT* æ ¼å¼ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—agdaçš„ç±»å‹çº¦æŸååˆ†å¼ºå¤§ã€‚

** Re: ä»é›¶å¼€å§‹çš„Agdaç”Ÿæ´»

*** ä»é›¶å¼€å§‹çš„è‡ªç„¶æ•°(Nat and Bool)
åœ¨agdaé‡Œï¼Œæˆ‘ä»¬ä¸€å¼€å§‹æ˜¯æ²¡æœ‰è‡ªç„¶æ•°çš„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨çš®äºšè¯ºå…¬ç†ã€‚
#+BEGIN_SRC agda
data Nat : Set where
  zero : Nat
  suc  : Nat -> Nat
#+END_SRC

ä¸€åˆ‡éƒ½ååˆ†ç®€æ´è€Œè‡ªç„¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨emacsé‡ŒæŒ‰ =C-c C-n= æ¥è¾“å…¥è¡¨è¾¾å¼è¿›è¡Œæµ‹è¯•ï¼Œæ¯”å¦‚ =suc (suc zero)= ã€‚

å¯æ˜¯æˆ‘ä»¬æ€»ä¸æƒ³å†™ä¸€ä¸ª3éƒ½è¦å†™æˆ =suc (suc (suc zero))= ,æˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬å®šä¹‰çš„è‡ªç„¶æ•°æ˜ å°„åˆ°æ™®é€šçš„åè¿›åˆ¶ç®—æ•°æ ‡è®°ï¼š
#+BEGIN_SRC agda
{-# BUILTIN NATURAL Nat #-}
#+END_SRC
äºæ˜¯æˆ‘ä»¬å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨è‡ªç„¶æ•°æ•°å­—äº†ï¼

ç®€å•å®šä¹‰å‡ ä¸ªåŸºæœ¬ç®—æœ¯ï¼š
#+BEGIN_SRC agda

_+_ : Nat â†’ Nat â†’ Nat
zero + n = n
(succ n) + m = succ (n + m)

_*_ : Nat â†’ Nat â†’ Nat
zero * m = zero
(succ n) * m = m + (n * m)

infixl 60 _*_
infixl 40 _+_

#+END_SRC

æ³¨æ„åˆ°è¿™é‡Œçš„ä¸­ç¼€å‡½æ•°è¡¨è¾¾ï¼Œagdaé‡Œå¯ä»¥ç”¨ä¸‹ç”»çº¿ =_= æ¥è¡¨ç¤ºè¿™é‡Œéœ€è¦å‚æ•°ã€‚
æœ€å¥½ç©çš„ä¸€ä¸ªä¾‹å­æ˜¯æˆ‘ä»¬å¯ä»¥å®šä¹‰å‡ºæ¥å’Œhaskellä¸€æ ·çš„if-then-elseã€‚
#+BEGIN_SRC agda
data Bool : Set where
  true  : Bool
  false : Bool

if_then_else_ : Bool -> Bool -> Bool
if true  then x else y = x
if false then x else y = y

infix  5 if_then_else_
#+END_SRC

Cool! æˆ‘ä»¬æœ‰äº†å¸ƒå°”è¿ç®—ï¼

*** ä»é›¶å¼€å§‹çš„åˆ—è¡¨(List)

#+BEGIN_SRC agda
data List (A : Set) : Set where
  []   : List A
  _::_ : A -> List A -> List A
#+END_SRC
å¯ä»¥çœ‹åˆ°ï¼Œå’Œhaskellçš„GADTå‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚

*** å°è¯•æ„é€ æˆ‘ä»¬çš„å¸¸ç”¨å°å‡½æ•°ï¼

#+BEGIN_SRC agda

id : {A : Set} â†’ A â†’ A
id x = x

map : {A B : Set} â†’ (A â†’ B) â†’ List A â†’ List B
map f [] = []
map f (x :: xs) = f x :: map f xs

foldl : {A B : Set} â†’ (B â†’ A â†’ B) â†’ B â†’ List A â†’ B
foldl f a [] = a
foldl f a (x :: xs) = foldl f (f a x) xs

#+END_SRC

éœ€è¦è¯´æ˜çš„æ˜¯agdaæœ‰implicitå‚æ•°åŠŸèƒ½ï¼Œéœ€è¦çœç•¥çš„termç›´æ¥ç”¨å¤§æ‹¬å·{åŒ…èµ·æ¥}å°±å¯ä»¥ã€‚
è¿™é‡Œçš„å®šä¹‰å’Œä½¿ç”¨å‡ ä¹å’Œhaskellä¸€æ¨¡ä¸€æ ·ã€‚

*** ç±»å‹å³å‘½é¢˜ï¼Œç¨‹åºå³è¯æ˜

å¯ä»¥è¯•è¯•å…ˆè¯æ˜æœ€ç®€å•çš„åŠ æ³•ç»“åˆå¾‹å’Œäº¤æ¢å¾‹ã€‚

**** è¯æ˜åŠ æ³•ç»“åˆå¾‹
#+BEGIN_SRC agda

+assoc : âˆ€ (m n p : Nat) â†’ (m + n) + p â‰¡ m + (n + p)
+assoc zero n p =
  begin
    (zero + n) + p
  â‰¡<>
    n + p
  â‰¡<>
    zero + (n + p)
  end

+assoc (suc m) n p = 
  begin
    ((suc m) + n) + p
  â‰¡<>
    suc (m + n) + p
  â‰¡<>
    suc ((m + n) + p)
  â‰¡< cong suc (+assoc m n p) >
    suc (m + (n + p))
  â‰¡<>
    suc m + (n + p)
  end

#+END_SRC
æ³¨æ„è¿™é‡Œ =begin, \==<>, end= éƒ½æ˜¯agdaæ ‡å‡†åº“å‡½æ•°

**** è¯æ˜åŠ æ³•äº¤æ¢å¾‹
#+BEGIN_SRC agda

+identity : âˆ€ (m : Nat) â†’ m + 0 â‰¡ m
+identity 0 = refl
+identity (suc n) =
  begin
    (suc n) + 0
  â‰¡<>
    suc (n + 0)
  â‰¡< cong suc (+identity n) >
    suc n
  end


+suc : âˆ€ (m n : Nat) â†’ m + suc n â‰¡ suc (m + n)
+suc 0 n = refl
+suc (suc m) n =
  begin
    (suc m) + (suc n)
  â‰¡<>
    suc (m + suc n)
  â‰¡< cong suc (+suc m n) >
    suc (suc (m + n))
  â‰¡<>
    suc (suc m + n)
  end


+comm : âˆ€ (m n : Nat) â†’ m + n â‰¡ n + m
+comm m 0 =
  begin
    m + 0
  â‰¡< +identity m >
    m
  â‰¡<>
    0 + m
  end
+comm m (suc n) =
  begin
    m + (suc n)
  â‰¡< +suc m n >
    suc (m + n)
  â‰¡< cong suc (+comm m n) >
    suc (n + m)
  â‰¡<>
    suc n + m
  end

#+END_SRC
ç”±äºagdaç®€æ´å¹²å‡€çš„è¯­æ³•ï¼Œå‡ ä¹ä¸éœ€è¦ä»»ä½•è§£é‡Šï¼Œä»£ç è‡ªæ˜ã€‚

*** æƒ³æ‰¾åˆ°ç›¸ç­‰çš„ä¸œè¥¿æ˜¯äººç±»ä¸€åˆ‡æ€è€ƒçš„æºå¤´
ç›¸ç­‰çœ‹ä¼¼ç®€å•ï¼Œå®åˆ™å¾ˆæ·±å¥¥ï¼Œä»¥è‡³äºåœ¨èŒƒç•´è®ºé‡Œå®šä¹‰äº†å¥½å‡ ç§ç›¸ç­‰éƒ½ä¸å¤ªå¤Ÿç”¨ï¼Œç¼–ç¨‹æ›´æ˜¯ç›¸ç­‰æ»¡å¤©é£ï¼Œé‡è½½ ==== ä¸€ç›´æ˜¯ä¸€ä»¶å¾ˆé‡è¦çš„äº‹ã€‚
åœ¨agdaé‡Œï¼Œç›¸ç­‰è‡ªç„¶ä¹Ÿæœ‰å¥½å‡ ç§ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆçœ‹çœ‹Propositional equalityã€‚

#+BEGIN_SRC agda
data _â‰¡_ {A : Set} (x : A) : A â†’ Set where
  refl : x â‰¡ x

infix 4 _â‰¡_
#+END_SRC
æ²¡é”™ï¼Œè¿™ç§ç›¸ç­‰çš„æƒ³æ³•å¾ˆç®€å•ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œé‚£ä¹ˆç›¸ç­‰ã€‚

**** ç›¸ç­‰çš„ä¸‰ä¸ªåŸºæœ¬ç‰¹æ€§

æ—¢ç„¶æœ‰äº†è‡ªåæ€§ï¼Œé‚£æˆ‘ä»¬çš„ç›¸ç­‰è‚¯å®šä¹Ÿæ˜¯å¯¹ç§°çš„ä¸”æ˜¯å¯ä¼ é€’çš„ï¼Œæˆ‘ä»¬æ¥è¯•ç€è¯æ˜ï¼š
#+BEGIN_SRC agda

sym : âˆ€ {A : Set} {x y : A}
  â†’ x â‰¡ y
  â†’ y â‰¡ x
sym refl = refl

trans : âˆ€ {A : Set} {x y z : A}
  â†’ x â‰¡ y
  â†’ y â‰¡ z
  â†’ x â‰¡ z
trans refl refl = refl

#+END_SRC

**** ç›¸ç­‰çš„å‡½æ•°å¯æ›¿æ¢æ€§
è¿™ä¸€ç‚¹å…¶å®æˆ‘ä»¬æ—©å·²è§è¯†è¿‡ï¼Œæ²¡é”™ï¼Œå°±æ˜¯å‰é¢ç”¨åˆ°çš„ =cong= å‡½æ•°ã€‚
è¿™é‡Œæˆ‘ä»¬æ¥è‡ªå·±åŠ¨æ‰‹å®šä¹‰ï¼š
#+BEGIN_SRC agda

cong : âˆ€ {A B : Set} (f : A â†’ B) {x y : A}
  â†’ x â‰¡ y
  â†’ f x â‰¡ f y
cong f refl = refl

#+END_SRC
åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œç­‰æ•ˆæ›¿æ¢äº†ï¼š
#+BEGIN_SRC agda

subst : âˆ€ {A : Set} (f : A â†’ Set) {x y : A}
  â†’ x â‰¡ y
  â†’ f x â†’ f y
subst f refl fx = fx

#+END_SRC

**** æ›´å¤šè¯æ˜ç›¸ç­‰çš„å·¥å…·
è¿˜è®°å¾—æˆ‘ä»¬å‰é¢ç”¨è¿‡çš„ =begin= =\==<>= =end= å‡½æ•°ä»¬å—ï¼Ÿäº†è§£äº†ç›¸ç­‰çš„åŸºæœ¬å®šä¹‰ä¹‹åï¼Œå®šä¹‰å®ƒä»¬å…¶å®ååˆ†ç®€å•ï¼š
#+BEGIN_SRC agda

infix  1 begin_
infixr 2 _â‰¡<>_ _â‰¡<_>_
infix  3 _end

begin_ : âˆ€ {A : Set} {x y : A}
  â†’ x â‰¡ y
  â†’ x â‰¡ y
begin xâ‰¡y = xâ‰¡y

_â‰¡<>_ : âˆ€ {A : Set} (x : A) {y : A}
  â†’ x â‰¡ y
  â†’ x â‰¡ y
x â‰¡<> xâ‰¡y = xâ‰¡y

_â‰¡<_>_ : âˆ€ {A : Set} (x : A) {y z : A}
  â†’ x â‰¡ y
  â†’ y â‰¡ z
  â†’ x â‰¡ z
x â‰¡< xâ‰¡y > yâ‰¡z = trans xâ‰¡y yâ‰¡z

_end : âˆ€ {A : Set} (x : A)
  â†’ x â‰¡ x
x end = refl

#+END_SRC
AgdaçœŸæ˜¯å¤ªå¥½ç©äº†ã€‚

*** ä¸‡ç‰©åˆå§‹ï¼šå®‡å®™çš„ç”Ÿæˆ
å¦‚æœæˆ‘ä»¬å®Œå…¨ä¸ä½¿ç”¨agda-stdlibï¼Œæˆ‘ä»¬ä¾¿ä¸å¿…éµå¾ªä¸å¿…è¦çš„å‘½åï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§é€»è¾‘ä»é›¶å¼€å§‹åˆ›é€ ä¸å®‰æ’å®‡å®™ã€‚
ä¸Šé¢ä¸€ä¸ªå¾ˆä¸èµ·çœ¼çš„åœ°æ–¹æåˆ°è¿‡ï¼Œagdaçš„ =Set= çš„ç±»å‹ä¸æ˜¯ =Set= ï¼ˆä¸ºäº†é€ƒé¿ç½—ç´ æ‚–è®ºï¼‰ã€‚é‚£ä¹ˆ =Set= åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ
åœ¨ä¸‡ç‰©åˆå§‹ï¼Œè°ä¹Ÿä¸çŸ¥é“è¿™æ˜¯å•¥ã€‚æˆ‘ä»¬ä¸å¦‚åŠ¨æ‰‹è‡ªå·±å°è¯•æ„é€ ï¼

ä¸ºäº†åç»­çš„æ„é€ æ–¹ä¾¿ï¼Œæˆ‘ä»¬åœ¨æ–‡ä»¶ç¬¬ä¸€è¡Œæ·»åŠ å¦‚ä¸‹ä¸€è¡ŒOPTIONï¼š
#+BEGIN_SRC agda
{-# OPTIONS --without-K --exact-split --safe #-}
#+END_SRC
ä¸‹é¢å¼€å§‹æˆ‘ä»¬çš„åˆ›é€ ä¹‹æ—…ï¼

**** å®‡å®™çš„æ¬¡ç¬¬
ä¸ºäº†ç»•å¼€ç½—ç´ æ‚–è®ºï¼Œæˆ‘ä»¬ä¸èƒ½ä»…ä»…åªæœ‰ä¸€ä¸ªå®‡å®™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ›´ /large/ çš„å®‡å®™æ¥æ— é™æ‹“å±•æˆ‘ä»¬åˆ›é€ çš„ä¸–ç•Œã€‚
#+BEGIN_SRC agda
data Level : Set where
  lzero : Level
  lsucc : Level -> Level
#+END_SRC
è¿™é‡Œçš„ =Set= åªæ˜¯ä¸€ä¸ª =Set 0= çš„è¯­æ³•ç³–ã€‚ä¸ºäº†è§„å®šå®‡å®™çš„æ¬¡åºï¼Œç±»ä¼¼äºè‡ªç„¶æ•°çš„inductionè§„åˆ™ï¼Œæˆ‘ä»¬æ„é€ äº†ç±»ä¼¼çš„ç»“æ„ï¼ˆä½†æ˜¯ä»£æ•°ç»“æ„ä¸åŒï¼‰ã€‚
æˆ‘ä»¬ä» =Set 0= å¼€å§‹æˆ‘ä»¬çš„åˆ›ä¸–ã€‚

#+BEGIN_SRC agda
open import Agda.Primitive public
 renaming (
            Level to Universe -- We speak of universes rather than of levels.
          ; lzero to ğ“¤â‚€       -- Our first universe is called ğ“¤â‚€
          ; lsuc to _âº        -- The universe after ğ“¤ is ğ“¤ âº
          ; SetÏ‰ to ğ“¤Ï‰        -- There is a universe ğ“¤Ï‰ strictly above ğ“¤â‚€, ğ“¤â‚, â‹¯ , ğ“¤â‚™, â‹¯
          )
 using    (_âŠ”_)               -- Least upper bound of two universes, e.g. ğ“¤â‚€ âŠ” ğ“¤â‚ is ğ“¤â‚

Type = Î» â„“ â†’ Set â„“

_Ì‡   : (ğ“¤ : Universe) â†’ Type (ğ“¤ âº)

ğ“¤â€ŠÌ‡  = Type ğ“¤

ğ“¤â‚ = ğ“¤â‚€ âº
ğ“¤â‚‚ = ğ“¤â‚ âº
ğ“¤â‚ƒ = ğ“¤â‚‚ âº

_âºâº : Universe â†’ Universe
ğ“¤ âºâº = ğ“¤ âº âº

universe-of : {ğ“¤ : Universe} (X : ğ“¤âŸÌ‡ ) â†’ Universe
universe-of {ğ“¤} X = ğ“¤

infix  1 _Ì‡
#+END_SRC
ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ =ğ“¤â€ŠÌ‡= æ¥æŒ‡ç§°å®é™…çš„å®‡å®™ï¼ˆğ“¤åªæ˜¯å®‡å®™çš„ç§©åºï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„Levelï¼‰ã€‚

**** åˆå§‹ä¸ç»ˆç»“å¯¹è±¡
æ­£å¦‚ =Set= è¿™ä¸€è¯ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›é€ é›†åˆçš„ä¸–ç•Œã€‚
é›†åˆçš„ä¸–ç•Œåœ¨èŒƒç•´è®ºä¸­æœ‰ä¸¤ä¸ªåŸºæœ¬å¯¹è±¡ï¼ˆç±»å‹ï¼‰ï¼Œå³åˆå§‹å…ƒç´  =ğŸ™= å’Œç»ˆç»“å…ƒç´  =ğŸ˜= ã€‚
#+BEGIN_SRC agda

variable
 ğ“¤ ğ“¥ ğ“¦ ğ“£ : Universe

data ğŸ™ : ğ“¤â‚€ Ì‡  where
 â‹† : ğŸ™

data ğŸ˜ : ğ“¤â‚€ Ì‡ where
#+END_SRC
è¿™é‡Œ =ğŸ˜= å°±æ˜¯ç©ºé›†ï¼ŒğŸ™ å°±æ˜¯ä»…æœ‰ä¸€ä¸ªå…ƒç´ çš„ /singleton/ ã€‚
æ¥å®šä¹‰åˆ›é€ è”ç³»çš„å‡½æ•°ï¼Œæœ‰äº†ä¸–ç•Œçš„åˆå§‹å’Œç»ˆç»“ï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¼åŠ¨æ‰‹æ„é€ ä¸åˆ»ç”»è¿™ä¸ªä¸–ç•Œäº†ã€‚
#+BEGIN_SRC agda

ğŸ™-induction : (A : ğŸ™ â†’ ğ“¤ Ì‡) â†’ A â‹† â†’ (x : ğŸ™) â†’ A x
ğŸ™-induction A a â‹† = a

ğŸ™-recursion : (B : ğ“¤ Ì‡) â†’ B â†’ ğŸ™ â†’ B
ğŸ™-recursion B = ğŸ™-induction (Î» _ â†’ B)


!ğŸ™ : {X : ğ“¤ Ì‡} â†’ X â†’ ğŸ™
!ğŸ™ x = â‹†



ğŸ˜-induction : (A : ğŸ˜ â†’ ğ“¤ Ì‡) â†’ (x : ğŸ˜) â†’ A x
ğŸ˜-induction A ()

ğŸ˜-recursion : (B : ğ“¤ Ì‡) â†’ ğŸ˜ â†’ B
ğŸ˜-recursion B = ğŸ˜-induction (Î» _ â†’ B)

!ğŸ˜ : (B : ğ“¤ Ì‡) â†’ ğŸ˜ â†’ B
!ğŸ˜ = ğŸ˜-recursion
#+END_SRC
æˆ‘ä»¬è¿˜å¯ä»¥ç”¨å‡½æ•°æ¥åˆ¤æ–­ä¸€ä¸ªé›†åˆæ˜¯å¦ä¸ºç©ºï¼ˆFalseï¼‰ï¼š
#+BEGIN_SRC agda

is-empty : ğ“¤ Ì‡ â†’ ğ“¤ Ì‡
is-empty X = X â†’ ğŸ˜

Â¬ : ğ“¤ Ì‡ â†’ ğ“¤ Ì‡
Â¬ = is-empty
#+END_SRC
åœ¨è¿™é‡Œï¼Œç©º ä¸ å‡ ä¸€è¯­åŒå…³ã€‚  

**** è‡ªç„¶æ•°å·åœŸé‡æ¥
æœ‰äº†ä¸Šé¢Levelçš„é¢„çƒ­ï¼Œè‡ªç„¶æ•°ä¸è¯·è‡ªæ¥ï¼š
#+BEGIN_SRC agda

data â„• : ğ“¤â‚€ Ì‡ where
  zero : â„•
  succ : â„• â†’ â„•

{-# BUILTIN NATURAL â„• #-}
#+END_SRC
æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªç„¶æ•°æ¥è¿›è¡Œæ„‰å¿«åœ°inductionäº†ï¼
#+BEGIN_SRC agda

â„•-induction : (A : â„• â†’ ğ“¤ Ì‡)
            â†’ A 0
            â†’ ((n : â„•) â†’ A n â†’ A (succ n))
            -------------------------------
            â†’ (n : â„•) â†’ A n
â„•-induction A aâ‚€ f = h where
  h : (n : â„•) â†’ A n
  h 0        = aâ‚€
  h (succ n) = f n (h n)
#+END_SRC
è¿™é‡Œï¼Œæ³¨é‡Šçš„--é•¿çº¿å’Œæ¨ç†å¼çš„æ¨ªçº¿è¾¾æˆäº†å®Œç¾çš„ç»Ÿä¸€ã€‚

è¿™é‡Œä½¿ç”¨äº†ä¾èµ–ç±»å‹çš„inductionå‡½æ•°ç±»å‹å†™æ³•ï¼Œå¦‚æœæˆ‘ä»¬é€€å›åˆ°ç±»å‹ä¸èƒ½ä¾èµ–äºå€¼çš„ä¸–ç•Œä¸­ï¼Œé‚£ä¹ˆ
æˆ‘ä»¬ä¾¿å¾—åˆ°äº†æ–°ï¼ˆé™åˆ¶æ›´å¼ºï¼‰çš„å‡½æ•°ï¼š
#+BEGIN_SRC agda

â„•-recursion : (X : ğ“¤ Ì‡)
            â†’ X
            â†’ (â„• â†’ X â†’ X)
            â†’ â„• â†’ X
â„•-recursion X = â„•-induction (Î» _ â†’ X)
#+END_SRC
å†™å®Œè¿™ä¸ªå‡½æ•°ï¼Œæˆ‘å¯¹ç€ç±»å‹è¶Šçœ‹è¶Šè§‰å¾—ç†Ÿæ‚‰ï¼Œçªç„¶è®°å¿†ä¸€é—ªï¼ˆâ€œæˆ‘æƒ³èµ·æ¥äº†ï¼[æŸä¸­äºŒå°è¯]â€ï¼‰ï¼Œè¿™ä¸å°±æ˜¯å‡½æ•° =foldr= å—ï¼
è¿™ä¸œè¥¿å±•å¼€å°±æ˜¯ï¼š =f n (f (n-1) (f (n-2) .. (f 0 a)..))=

å¦‚æœç›´æ¥æŠŠä¸­é—´çš„æ¯ä¸ªå…ƒç´ å¿½ç•¥æ‰ï¼Œè¿›è¡Œ =n= æ¬¡è¿­ä»£ï¼Œæˆ‘ä»¬åˆå¾—åˆ°äº†ï¼š
#+BEGIN_SRC agda

â„•-iteration : (X : ğ“¤ Ì‡)
            â†’ X
            â†’ (X â†’ X)
            â†’ â„• â†’ X
â„•-iteration X x f = â„•-recursion X x (Î» _ x â†’ f x)
#+END_SRC
å±•å¼€å°±æ˜¯ =f (f (f (.. (f a) ..)))= (è¿­ä»£næ¬¡)ã€‚

å¥½äº†ï¼Œæœ‰äº†è¿™äº›å·¥å…·ï¼ŒåŸºæœ¬çš„ç®—æœ¯è¿ç®—å·²ç»è·ƒç„¶äºçœ¼å‰äº†ï¼š
#+BEGIN_SRC agda

module Arithmetic where

  _+_ _Ã—_ : â„• â†’ â„• â†’ â„•

  x + 0 = x
  x + succ y = succ (x + y)

  x Ã— 0 = 0
  x Ã— succ y = x + x Ã— y

  infixl 20 _+_
  infixl 21 _Ã—_
#+END_SRC
æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ä¸Šé¢å®šä¹‰çš„iterationå‡½æ•°æ¥å®šä¹‰arithmeticï¼š
#+BEGIN_SRC agda

module Arithmetic' where

  _+_ _Ã—_ : â„• â†’ â„• â†’ â„•

  x + y = h y where
    h : â„• â†’ â„•
    h = â„•-iteration â„• x succ

  x Ã— y = h y where
    h : â„• â†’ â„•
    h = â„•-iteration â„• 0 (x +_)

  infixl 20 _+_
  infixl 21 _Ã—_
#+END_SRC
è¿™é‡Œ =(x +_)= çš„å†™æ³•å±…ç„¶è®©æˆ‘è«åæƒ³èµ·äº†Scalaï¼ˆé€ƒ

*** ä¸‡ç‰©åˆå§‹ï¼šå…ƒç´ çš„ç»„åˆ
Recap! æˆ‘ä»¬æœ‰äº†åˆå§‹å®‡å®™ =ğ“¤â‚€= åˆå§‹å…ƒç´  =ğŸ˜= å’Œç»ˆç»“å…ƒç´  =ğŸ™= ï¼Œæˆ‘ä»¬æœ‰äº†è‡ªç„¶æ•°ã€‚

ä¸‹é¢æˆ‘ä»¬å¼€å§‹æ€è€ƒï¼Œè¿˜æœ‰ä»€ä¹ˆæ˜¯å¯ä»¥åˆ›é€ çš„ï¼Œæˆ–è€…æˆ‘ä»¬ç©¶ç«Ÿæƒ³è¦åˆ›é€ ä»€ä¹ˆï¼Ÿ
æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†ä¸æ­¢ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½æŠŠå¥¹ä»¬ç»„åˆåœ¨ä¸€èµ·å‘¢ï¼Ÿ
å¦‚æœè¦ç»„åˆï¼Œç»„åˆçš„æ–¹å¼åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

**** æˆ‘æƒ³æŠŠä¸€ä¸ªä¸œè¥¿çœ‹æˆä¸¤ç§ä¸œè¥¿ï¼šX or Y
ç†Ÿæ‚‰Haskellçš„åŒå­¦è‚¯å®šå¯¹ç±»å‹ =Either= ååˆ†ç†Ÿæ‚‰ï¼Œè¿™ç§æ„é€ æ–¹æ³•åœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€é‡Œæ”¯æŒè¿˜å¾ˆä¸å®Œå–„
ï¼ˆæ²¡é”™ï¼Œæˆ‘å°±æ˜¯è¦é»‘åªæœ‰structçš„è¯­è¨€ï¼Œå†™ä¸€ä¸ªè§£é‡Šå™¨è¦å¼„ä¸€å †tagï¼Œåº”è¯¥å­¦ä¹ Rustçš„enumï¼‰ã€‚
åœ¨Agdaé‡Œï¼Œæˆ‘ä»¬æœ‰äº†æ›´åŠ å¼ºå¤§çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬æƒ³è¦æŒ‡ä»£çš„ä¸¤ä¸ªç±»å‹ä¸ä»…å¯ä»¥æ˜ å°„åˆ°ä¸€ä¸ªæ–°æ„é€ çš„ç±»å‹é‡Œï¼Œ
è¿˜å¯ä»¥è®©ä»–ä»¬ç›¸äº’ä¾èµ–ã€‚ä½†è¿™é‡Œæˆ‘ä»¬å…ˆæ¥çœ‹æœ€ç®€å•çš„ =binary sum type= ã€‚

#+BEGIN_SRC agda

data _+_ {ğ“¤ ğ“¥} (X : ğ“¤ Ì‡) (Y : ğ“¥ Ì‡) : ğ“¤ âŠ” ğ“¥ Ì‡ where
  inl : X â†’ X + Y
  inr : Y â†’ X + Y
#+END_SRC
å¦‚æœå­¦è¿‡èŒƒç•´è®ºçš„åŒå­¦çœ‹åˆ°è¿™ä¸ªä¸€å®šä¼šå€æ„Ÿäº²åˆ‡ï¼Œè¿™å’Œæ•°å­¦ä¸Šçš„å®šä¹‰å¦‚å‡ºä¸€è¾™ã€‚

æŒ‰ç…§æˆ‘ä»¬çš„æƒ¯ä¾‹ï¼Œè¿›è¡Œinductionå’Œrecursionï¼š
#+BEGIN_SRC agda

+-induction : {X : ğ“¤ Ì‡} {Y : ğ“¥ Ì‡} (A : X + Y â†’ ğ“¦ Ì‡)
            â†’ ((x : X) â†’ A (inl x))
            â†’ ((y : Y) â†’ A (inr y))
            -----------------------
            â†’ (z : X + Y) â†’ A z
+-induction A f g (inl x) = f x
+-induction A f g (inr y) = g y

+-recursion : {X : ğ“¤ Ì‡} {Y : ğ“¥ Ì‡} {A : ğ“¦ Ì‡}
            â†’ (X â†’ A)
            â†’ (Y â†’ A)
            â†’ X + Y â†’ A
+-recursion {ğ“¤} {ğ“¥} {ğ“¦} {X} {Y} {A} = +-induction (Î» _ â†’ A)
#+END_SRC
ä»£ç å·²ç»å‡ ä¹ä¸è¨€è‡ªæ˜ã€‚
[è¿™é‡Œæ‰“ç®—åæœŸè¡¥å›¾]

ç°åœ¨æˆ‘ä»¬å¯ä»¥ç»„åˆæ–°çš„å…ƒç´ ï¼ˆç±»å‹ï¼‰äº†:
#+BEGIN_SRC agda

ğŸš : ğ“¤â‚€ Ì‡
ğŸš = ğŸ™ + ğŸ™
#+END_SRC
è¿™é‡Œä»‹ç»ä¸€ä¸ªagdaçš„æ–°åŠŸèƒ½ï¼Œå³ç»™ä¸€ä¸ªpatternèµ·ä¸€ä¸ªæ–°åå­—ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä¸€ä¸ªpatternèµ·ä¸åŒçš„åˆ«åï¼š
#+BEGIN_SRC agda

pattern â‚€ = inl â‹†
pattern â‚ = inr â‹†
#+END_SRC
ç»§ç»­induction:
#+BEGIN_SRC agda

ğŸš-induction : (A : ğŸš â†’ ğ“¤ Ì‡)
            â†’ A â‚€
            â†’ A â‚
            ----------------
            â†’ (n : ğŸš) â†’ A n
ğŸš-induction A aâ‚€ aâ‚ â‚€ = aâ‚€
ğŸš-induction A aâ‚€ aâ‚ â‚ = aâ‚
#+END_SRC
So far so good. é™¤äº† =_+_= çš„ç»„åˆæ–¹å¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æœ‰ =Î£= ã€‚

**** æˆ‘æƒ³æŠŠä¸¤ä¸ªä¸œè¥¿çœ‹æˆä¸€ç§ä¸œè¥¿ï¼šX and Y
æˆ‘ä»¬é¦–å…ˆæœ‰æˆ‘ä»¬çš„dependent sum!
#+BEGIN_SRC agda

record Î£ {ğ“¤ ğ“¥} {X : ğ“¤ Ì‡} (Y : X â†’ ğ“¥ Ì‡) : ğ“¤ âŠ” ğ“¥ Ì‡ where
  constructor _,_
  field
    x : X
    y : Y x

prâ‚ : {X : ğ“¤ Ì‡} {Y : X â†’ ğ“¥ Ì‡} â†’ Î£ Y â†’ X
prâ‚ (x , y) = x

prâ‚‚ : {X : ğ“¤ Ì‡} {Y : X â†’ ğ“¥ Ì‡} â†’ (z : Î£ Y) â†’ Y (prâ‚ z)
prâ‚‚ (x , y) = y
#+END_SRC

- *NOTE* 

  åœ¨æˆ‘å†™ä¸‹ä»Šå¤©çš„å†…å®¹çš„æ—¶å€™ï¼ˆ2020.03.07ï¼‰ï¼Œagdaï¼ˆver 2.6.0.1ï¼‰è¿˜ä¸æ”¯æŒåœ¨ç±»å‹å£°æ˜ä¸­çš„ =pattern matching= ã€‚
  åœ¨agdaå³å°†åˆ°æ¥çš„2.6.1.0ä¸­ä¼šæ”¯æŒè¿™ä¸€ååˆ†æœ‰ç”¨çš„åŠŸèƒ½ã€‚
  å…·ä½“è§ï¼š[[https://stackoverflow.com/questions/60557445/agda-pattern-matching-inside-type-declarations][Agda pattern matching inside ...]]






